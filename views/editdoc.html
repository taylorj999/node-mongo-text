{% extends 'frametemplate.html' %}

{% block title %}Document{% endblock %}

{% block header %}
<script type="text/javascript" src="/js/rtf-converters.js"></script>
<script type="text/javascript">
	function removeRTF() {
		textConverter = new TextConverter();
		$("textarea[name=textdata]").val(textConverter.convert($("textarea[name=textdata]").val()));
	}
	function submitForm() {
		document.forms["editdoc"].submit();
	}
</script>
{% endblock %}

{% block leftcolumn %}
  {% if textdata %}
    <div class="taglist">
    	<span style="font-size: 12px">Doc Tags</span>
		{% for tag in textdata.tags.sort() %}
		<div class="tag" id="{{tag}}"><a href="/search?tags={{tag}}&page=1">{{tag}}</a> {% if user %}<img src="/images/delete-sm.png" class="delete-button" onClick="javascript:deleteTag('{{image._id.toString()}}','{{tag}}');"/>{% endif %}</div>
		{% endfor %}
	</div>
	{% if user %}
		<span style="font-size: 12px">Add Tag</span>
		<div class="tag">
			<form name="addtag" method="post" action="" onsubmit="addTag('{{textdata._id.toString()}}');return false;">
				<input type="text" name="newtag" value=""/>
				<input type="button" name="add" class="add-button" onClick="javascript:addTag('{{textdata._id.toString()}}');"/>
			</form>
		</div>
	{% endif %}
	{% if image.tags.indexOf('series') >=0 %}
		<span style="font-size: 12px">Series Info</span>
		<div class="series">
		{% if user %}
			<form name="setsequence" method="post" action="" onsubmit="setSequence('{{textdata._id.toString()}}');return false;">
				<input type="text" name="series_name" value="{{textdata.story.storyname}}"/>
				<input type="text" name="sequence" value="{{textdata.story.chapter}}"/>
				<input type="button" name="set" value="set" class="set-button" onClick="javascript:setSequence('{{image._id.toString()}}');"/>
			</form>
	 	{% else %}
	 		<span style="font-size: 12px">Series: {{textdata.story.storyname}}</span>
	 	 	<span style="font-size: 12px">Sequence: {{textdata.story.chapter}}</span>
	 	{% endif %}
			<span style="font-size: 12px">Images in series: {{textdata.story.count}}</span>
		</div>
	{% endif %}
	{% if user %}
		{% if image.deleted %}
		<div class="delete">
			<input type="button" name="undelete" value="Un-Delete Image" class="delete-image" onClick="javascript:unDeleteImage('{{textdata._id.toString()}}');"/>
		</div>
		{% else %}
		<div class="delete">
			<input type="button" name="delete" value="Delete Image" class="delete-image" onClick="javascript:deleteImage('{{textdata._id.toString()}}');"/>
		</div>
		{% endif %}
	{% endif %}
	<div class="imagedetail">
		<div id="original">Original: {{textdata.source}}</div>
		<div id="uploaded">Uploaded on: {{textdata.original_date|date('Y-m-d')}}</div>
	</div>
  {% endif %}
{% endblock %}

{% block main %}
	<div id="alert">{{error}}</div>
	<div id="message">{{message}}</div>
	{% if textdata %}
	<div class="removertfbutton">
		<a href="javascript:removeRTF();">Remove RTF Encoding</a>
	</div>
	<div class="savebutton">
		<a href="javascript:submitForm();">Save changes</a>
	</div>
	<div class="revertbutton">
		<a href="revert?id={{textdata._id.toString()}}">Revert to previous version</a>
	</div>
	<form name="editdoc" method="post" action="/save">
		<input type="hidden" name="id" value="{{textdata._id.toString()}}"/>
	<div id="textdata">
		<textarea name="textdata" rows="20" cols="80">{{textdata.current}}</textarea>
	</div>
	</form>
		
	{% endif %}
{% endblock %}